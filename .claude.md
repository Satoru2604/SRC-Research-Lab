# Claude AI Assistant Context for SRC Research Lab

This file provides context and guidelines for AI assistants (like Claude) working on this repository.

## Project Overview

**SRC Research Lab** is the open research layer for the Semantic Recursive Compression (SRC) Engine. This repository provides:
- Secure bridge interface to the proprietary SRC Engine
- Benchmarking tools for compression algorithm comparison
- Metrics (CAQ - Compression-Accuracy Quotient) for evaluation
- Research experiments and findings

**Key Principle**: This is a research lab focused on transparency, reproducibility, and academic rigor.

## Repository Structure

```
src-research-lab/
├── docs/                    # All documentation files
│   ├── index.md            # Documentation index
│   ├── engineeringculture.md  # Contribution guidelines
│   └── api/                # API documentation (future)
├── scripts/                 # Executable scripts
│   ├── run_baseline.py     # Main benchmark script
│   └── src_bridge.py       # Bridge to SRC Engine
├── metrics/                 # Metric implementations
│   └── caq_metric.py       # CAQ metric calculator
├── tests/                   # Test files and fixtures
│   └── fixtures/           # Test data files
├── results/                 # Benchmark results (gitignored)
├── experiments/             # Research experiments
├── .github/                 # GitHub workflows (future)
├── README.md               # Main project README
├── LICENSE.md              # License information
├── .gitignore              # Git ignore rules
└── .claude.md              # This file
```

## File Organization Rules

### When Creating New Files

1. **Python Scripts (executable)**:
   - Place in `scripts/` directory
   - Make executable: `chmod +x scripts/script_name.py`
   - Add shebang: `#!/usr/bin/env python3`

2. **Python Modules (importable)**:
   - Place in `src/` directory with proper package structure
   - Example: `src/bridge/engine.py`

3. **Test Files**:
   - Place in `tests/` directory
   - Naming: `test_<module_name>.py`
   - Test fixtures: `tests/fixtures/`

4. **Documentation**:
   - Place in `docs/` directory
   - User guides: `docs/`
   - API docs: `docs/api/`
   - Examples: `docs/examples/`

5. **Benchmark Results**:
   - Place in `results/` directory
   - These are gitignored by default

6. **Temporary Test Files**:
   - Use `tests/fixtures/` for permanent test data
   - Generate temporary files in `results/` or `/tmp/`
   - Always clean up after tests

### Root Directory Policy

**Keep the root directory clean!** Only these files should be in root:
- `README.md`
- `LICENSE.md`
- `.gitignore`
- `.claude.md`
- Package files (`setup.py`, `pyproject.toml` if needed)

## Branching Strategy

### When Making Changes

**Always create a new branch for changes:**

```bash
# Feature branch
git checkout -b feature/descriptive-name

# Bug fix branch
git checkout -b fix/descriptive-name

# Documentation branch
git checkout -b docs/descriptive-name
```

**Branch naming format**: `<type>/<short-description>`

### Types
- `feature/` - New functionality
- `fix/` - Bug fixes
- `docs/` - Documentation updates
- `refactor/` - Code improvements
- `test/` - Test additions
- `experiment/` - Research experiments
- `chore/` - Maintenance tasks

### Examples
- `feature/add-brotli-support`
- `fix/caq-division-error`
- `docs/update-api-reference`
- `experiment/transformer-compression`

## Commit Message Format

Follow conventional commits:

```
<type>(<scope>): <subject>

<optional body>

<optional footer>
```

### Types
- `feat` - New feature
- `fix` - Bug fix
- `docs` - Documentation
- `style` - Formatting
- `refactor` - Code refactoring
- `test` - Tests
- `chore` - Maintenance

### Examples

```bash
# Simple
feat(benchmark): add lz4 compression support

# With body
fix(caq): handle zero cpu_seconds edge case

Previously would cause division by zero. Now uses log1p
to handle this case gracefully.

# With issue reference
docs(readme): add installation section

Closes #42
```

## Coding Standards

### Python Style
- Follow PEP 8
- Use type hints
- Max line length: 100 characters
- Use docstrings for public functions

### Example Function
```python
def compress_file(input_path: Path, output_path: Path, workers: int = 1) -> dict:
    """
    Compress a file using the SRC Engine.

    Args:
        input_path: Path to input file (must exist)
        output_path: Path to output file (will be created)
        workers: Number of parallel workers

    Returns:
        Dictionary with compression results

    Raises:
        ValueError: If input_path does not exist
    """
    pass
```

## Security Requirements

This project includes a bridge to a proprietary engine. Security is critical:

1. **Path Validation**: Always validate file paths are workspace-relative
2. **No Network**: Engine must run offline only
3. **Error Sanitization**: Never expose internal paths or stack traces
4. **Resource Limits**: Use timeouts and resource constraints
5. **No Secrets**: Never commit credentials or API keys

## Common Tasks

### Adding a New Compressor to Baseline

1. Edit `scripts/run_baseline.py`
2. Add compressor to the `compressors` list
3. Add command mapping to `commands` dict
4. Add extension mapping to `ext_map` dict
5. Test with `./scripts/run_baseline.py`
6. Update docs if needed

### Creating a New Metric

1. Create `metrics/new_metric.py`
2. Implement metric function with docstring
3. Add unit tests in `tests/test_new_metric.py`
4. Document in `docs/metrics.md`
5. Integrate into benchmark scripts if needed

### Adding a New Experiment

1. Create `experiments/experiment_name/`
2. Add README explaining hypothesis and methodology
3. Create experiment script
4. Document findings in experiment README
5. Link from main experiments README

## Testing Guidelines

### Before Committing
```bash
# Run tests (when available)
python -m pytest tests/

# Run baseline benchmark
./scripts/run_baseline.py

# Check for errors
python -m py_compile scripts/*.py metrics/*.py
```

### Test Data
- Permanent fixtures: `tests/fixtures/`
- Generated test files: Clean up after use
- Never commit large binary files

## Documentation Guidelines

### When to Update Docs

Update documentation when you:
- Add new features
- Change APIs
- Modify configuration
- Fix bugs affecting documented behavior

### Documentation Style
- Clear and concise
- Include examples
- Explain "why" not just "how"
- Keep in sync with code

## AI Assistant Best Practices

### When Editing This Repository

1. **Read first**: Check existing code structure before making changes
2. **Follow conventions**: Use established naming and organization patterns
3. **Branch workflow**: Always suggest creating a branch for changes
4. **Clean root**: Move files to appropriate subdirectories
5. **Document changes**: Update relevant docs when changing functionality
6. **Test thoroughly**: Run benchmarks and tests before committing
7. **Reference style guide**: Follow `docs/engineeringculture.md`

### File Creation Checklist

When creating a new file, ask:
- [ ] Is this file in the correct directory?
- [ ] Does it follow naming conventions?
- [ ] Is it documented if public-facing?
- [ ] Are there tests if applicable?
- [ ] Is it added to `.gitignore` if temporary?

### Commit Checklist

Before committing:
- [ ] Files are in correct directories
- [ ] Root directory is clean
- [ ] Commit message follows conventions
- [ ] Documentation is updated
- [ ] Tests pass (if applicable)

## Key Technologies

- **Language**: Python 3.8+
- **Engine**: Proprietary SRC Engine (via subprocess)
- **Compressors**: gzip, bzip2, xz, zstd, lz4
- **Metrics**: CAQ (Compression-Accuracy Quotient)
- **Testing**: pytest (future)

## External Resources

- Engineering culture: `docs/engineeringculture.md`
- Main README: `README.md`
- License: `LICENSE.md`

## Questions or Clarifications

When uncertain:
1. Check `docs/engineeringculture.md` for guidelines
2. Look at existing code for patterns
3. Ask the user for clarification
4. Propose a solution and get approval

## Project Goals

- **Transparency**: Open research methodology
- **Reproducibility**: Clear benchmarks and metrics
- **Security**: Safe interface to proprietary engine
- **Academic rigor**: Sound experimental design
- **Clean code**: Professional, maintainable codebase

---

Last updated: 2025-10-13
Version: 1.0
